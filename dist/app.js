"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("./controllers/index");
const express_1 = __importDefault(require("express"));
const morgan_1 = __importDefault(require("morgan"));
const AppError_1 = __importDefault(require("./services/AppError"));
const globalErrorHandler_1 = require("./services/globalErrorHandler");
const Routers_1 = require("./decorators/Routers");
const cors_1 = __importDefault(require("cors"));
const utils_1 = require("./services/utils");
const App = (0, express_1.default)();
const url = process.env.BASE_URL || "/api/v1";
App.use((0, cors_1.default)());
App.use((0, morgan_1.default)("dev"));
App.use(`${url}/uploads`, express_1.default.static("uploads"));
App.post("/webhook/stripe", express_1.default.raw({ type: "application/json" }), (0, utils_1.StripeWebhook)());
App.use(express_1.default.json());
App.use(express_1.default.urlencoded({ extended: true }));
App.use(url, Routers_1.routers[index_1.HotelsController.name]);
App.use(url, Routers_1.routers[index_1.CabinController.name]);
App.use(url, Routers_1.routers[index_1.BookingController.name]);
App.use(url, Routers_1.routers[index_1.AuthGuestController.name]);
App.use(url, Routers_1.routers[index_1.AuthHotelController.name]);
App.use(url, Routers_1.routers[index_1.RolesController.name]);
App.use(url, Routers_1.routers[index_1.CabinReviewController.name]);
App.use(url, Routers_1.routers[index_1.SearchLocationProxyController.name]);
App.all("*", (req, res, next) => {
    next(new AppError_1.default(`Route not found: ${req.originalUrl}`, 404));
});
App.use(globalErrorHandler_1.globalErrorHandler);
exports.default = App;
